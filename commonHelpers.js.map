{"version":3,"file":"commonHelpers.js","sources":["../src/js/api.js","../src/js/common.js","../src/main.js"],"sourcesContent":["import axios from 'axios';\nimport iziToast from 'izitoast';\nconst API_KEY = '32117995-da98556d394b8c9b5a96c2a58';\nconst BASE_URL = 'https://pixabay.com/api';\n\nconst per_page = 40;\nlet page = 1;\nlet query;\n\naxios.defaults.baseURL = BASE_URL;\n\nconst incrementPageCount = () => {\n  page += 1;\n};\n\nconst resetPageCount = () => {\n  page = 1;\n};\n\nconst getCurrentQuery = () => {\n  return query;\n};\n\nconst fetchPhotos = async newQuery => {\n  console.log('newQuery:', newQuery);\n  console.log('query === newQuery:', query === newQuery);\n  console.log('page:', page);\n\n  if (newQuery && query !== newQuery) {\n    resetPageCount();\n    query = newQuery;\n  } else {\n    incrementPageCount();\n  }\n  console.log('page:', page);\n\n  const searchParams = new URLSearchParams({\n    // q: newQuery || '',\n    q: newQuery || query,\n    page,\n    per_page,\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: true,\n    key: API_KEY,\n  });\n\n  try {\n    const { data, status } = await axios.get(`/?${searchParams}`);\n    // TODO: REMOVE ALL HANDLING LOGIC TO THE OUTER CODE.\n    // ❗❗❗RETURN ONLY RES - THE PROMISE\n    if (status === 429) {\n      iziToast.warning({\n        message: 'Too many requests. Limit exceeded. Try again later',\n        position: 'topCenter',\n        timeout: 8000,\n      });\n\n      throw new Error('Too many requests. Limit exceeded. Try again later');\n    }\n\n    const { totalHits, hits } = data;\n    console.log('hits.length:', hits.length);\n\n    const isEndOfResults = totalHits < page * per_page;\n\n    console.log('isEndOfResults:', isEndOfResults);\n\n    //   add \"query\" & \"isEndOfResults\" to use it for later handling\n    return { ...data, query, isEndOfResults };\n  } catch (error) {\n    console.log(error);\n    throw error;\n  }\n};\n\nexport { fetchPhotos, getCurrentQuery };\n","const CLASSES = {\n  hidden: 'visually-hidden',\n};\n\nconst ATTRIBUTES = {\n  disabled: 'disabled',\n};\n\nconst showElement = el => {\n  el.classList.remove(CLASSES.hidden);\n};\n\nconst hideElement = el => {\n  el.classList.add(CLASSES.hidden);\n};\n\nconst enableElement = el => {\n  el.removeAttribute(ATTRIBUTES.disabled);\n};\n\nconst disableElement = el => {\n  el.setAttribute(ATTRIBUTES.disabled, '');\n};\n\nconst isNotEmpty = arr => Array.isArray(arr) && arr.length > 0;\n\nexport { showElement, hideElement, isNotEmpty, enableElement, disableElement };\n","// ✅Submit handler\n// ✅Api fetch photos\n// ✅Render markup\n// On image click\n// ✅Load more\n// Infinity scroll\n\nimport iziToast from 'izitoast';\nimport SimpleLightbox from 'simplelightbox';\n\nimport { fetchPhotos, getCurrentQuery } from './js/api';\nimport {\n  disableElement,\n  enableElement,\n  hideElement,\n  isNotEmpty,\n  showElement,\n} from './js/common';\n\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport 'izitoast/dist/css/iziToast.min.css';\n\nconst refs = {\n  form: document.querySelector('form#search-form'),\n  input: document.querySelector('input[name=\"searchQuery\"]'),\n  gallery: document.querySelector('div.gallery'),\n  submitBtn: document.querySelector('button[type=\"submit\"]'),\n  loadMoreBtn: document.querySelector('button.load-more'),\n};\n\nconst clearMarkup = element => {\n  element.innerHTML = '';\n};\n\nconst convertArrToPhotosMarkup = arr => {\n  return (\n    isNotEmpty(arr) &&\n    arr\n      .map(el => {\n        const {\n          webformatURL,\n          largeImageURL,\n          tags,\n          likes,\n          views,\n          comments,\n          downloads,\n        } = el;\n\n        return `\n    <li class=\"photo-card\">\n        <img src=\"${largeImageURL}\" alt=\"${tags}\" loading=\"lazy\" />\n        <div class=\"info\">\n            <p class=\"info-item\">\n                <b>Likes</b>\n                ${likes}\n            </p>\n            <p class=\"info-item\">\n                <b>Views</b>\n                ${views}\n            </p>\n            <p class=\"info-item\">\n                <b>Comments</b>\n                ${comments}\n            </p>\n            <p class=\"info-item\">\n                <b>Downloads</b>\n                ${downloads}\n            </p>\n         </div>\n    </li>`;\n      })\n      .join('')\n  );\n};\n\nconst renderPhotosMarkup = photos => {\n  console.log('photos:', photos);\n  const markup = convertArrToPhotosMarkup(photos);\n  // erase gallery before rendering a new one\n  clearMarkup(refs.gallery);\n  refs.gallery.insertAdjacentHTML('beforeend', markup);\n};\n\nconst onInput = e => {\n  const inputValLength = e.target.value.length;\n  inputValLength >= 2\n    ? enableElement(refs.submitBtn)\n    : disableElement(refs.submitBtn);\n};\n\nconst onSubmit = async e => {\n  e.preventDefault();\n\n  const inputVal = e.target.elements['searchQuery'].value;\n\n  // remove double whitespaces and trim input value\n  const normalizedInputVal = inputVal.replace(/\\s+/g, ' ').trim();\n\n  refs.form.reset();\n  disableElement(refs.submitBtn);\n\n  try {\n    const { hits, totalHits, query } = await fetchPhotos(normalizedInputVal);\n\n    if (!isNotEmpty(hits)) {\n      iziToast.warning({\n        message: `Sorry, there are no images matching \"${query}\". Please try another search`,\n        position: 'topCenter',\n        timeout: 4000,\n      });\n      return;\n    }\n\n    iziToast.success({\n      message: `Hooray! We found ${totalHits} images.`,\n      position: 'topCenter',\n      timeout: 1500,\n    });\n\n    renderPhotosMarkup(hits);\n    showElement(refs.loadMoreBtn);\n  } catch (error) {\n    console.log(error);\n  }\n};\n\nconst onLoadMore = async () => {\n  const currentQuery = getCurrentQuery();\n  const { hits, isEndOfResults } = await fetchPhotos(currentQuery);\n  console.log('hits:', hits);\n\n  const markup = convertArrToPhotosMarkup(hits);\n  refs.gallery.insertAdjacentHTML('beforeend', markup);\n\n  if (isEndOfResults) {\n    setTimeout(() => {\n      iziToast.warning({\n        message: `We're sorry, but you've reached the end of search results.`,\n        position: 'topCenter',\n        timeout: 3500,\n      });\n    }, 1000);\n\n    hideElement(refs.loadMoreBtn);\n  }\n};\n\n// TODO: add event listener on input with cb, that checks whether input is empty. if it is empty iziToast about it\n// TODO: toTopBtn\nrefs.input.addEventListener('input', onInput);\nrefs.form.addEventListener('submit', onSubmit);\nrefs.loadMoreBtn.addEventListener('click', onLoadMore);\n"],"names":["API_KEY","BASE_URL","per_page","page","query","axios","incrementPageCount","resetPageCount","getCurrentQuery","fetchPhotos","newQuery","searchParams","data","status","iziToast","totalHits","hits","isEndOfResults","error","CLASSES","ATTRIBUTES","showElement","el","hideElement","enableElement","disableElement","isNotEmpty","arr","refs","clearMarkup","element","convertArrToPhotosMarkup","webformatURL","largeImageURL","tags","likes","views","comments","downloads","renderPhotosMarkup","photos","markup","onInput","onSubmit","normalizedInputVal","onLoadMore","currentQuery"],"mappings":"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"}